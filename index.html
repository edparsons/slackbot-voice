<html>

<head>
    <title>Cha Chinger</title>
    <meta name="robots" content="noindex">
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <style>
        body {
            font-family: 'Lucida Grand', Helvetica, Arial, sans-serif;
        }
        #charges {
            margin: 20px;
        }
        .train-ride {
            margin: 5px;
        }
        .play-anything {
            margin: 5px;
        }
        .failed-charge {
            color: darkRed;
            margin: 5px;
        }
        .successful-charge {
            color: darkGreen;
            margin: 5px;
        }
        input {
            border : solid 2px #DDDDDD;
            border-radius : 3px;
            moz-border-radius : 3px;
            font-size : 20px;
            color : #333333;
            padding : 5px 10px;
            background : whiteSmoke;
        }
        input[type=text] {
            width: 320px;
        }
    </style>
    <script type="text/javascript">
        var host = location.origin.replace(/^http/, 'ws');
        var socket = io(host);
        socket.on('chargeSucceeded', function (charge) {
            var chargeLi = $('<li class="successful-charge"></li>');
            $(chargeLi).text("CHARGE SUCCESSFUL for $"+(charge.amount/100).toFixed(2));
            $('#charges').prepend(chargeLi);
            document.getElementById('cash_register').play();
        });

        socket.on('chargeFailed', function (charge) {
            var chargeLi = $('<li class="failed-charge"></li>');
            $(chargeLi).text("CHARGE FAILED for $"+(charge.amount/100).toFixed(2));
            $('#charges').prepend(chargeLi);
            document.getElementById('denied').play();
        });

        socket.on('chargeRefunded', function (charge) {
            var chargeLi = $('<li class="failed-charge"></li>');
            $(chargeLi).text("CHARGE REFUNDED for $"+(charge.amount/100).toFixed(2));
            $('#charges').prepend(chargeLi);
            document.getElementById('denied').play();
        });

        socket.on('trainDone', function (charge) {
            var chargeLi = $('<li class="train-ride"></li>');
            $(chargeLi).text("CIRCLECI: brandfolder-production deployed");
            $('#charges').prepend(chargeLi);
            document.getElementById('choochoo').play();
        });

        socket.on('trainCrashed', function (data) {
            var chargeLi = $('<li class="train-ride"></li>');
            $(chargeLi).text("CIRCLECLI: FAILED deploying brandfolder-production");
            $('#charges').prepend(chargeLi);
            document.getElementById('crashed').play();
        });

        socket.on('deploy', function (data) {
            var chargeLi = $('<li class="train-ride"></li>');
            $(chargeLi).text("New deploy; refreshing in 30 seconds");
            $('#charges').prepend(chargeLi);            
            setTimeout(function() { location.reload(); }, 30000);
        });

        socket.on('refresh', function (data) {
            location.reload();
        });        

        socket.on('anyURL', function (url) {
            var chargeLi = $('<li class="play-anything"></li>');
            $(chargeLi).text("Played: "+url);
            $('#charges').prepend(chargeLi);
            var audio = new Audio(decodeURIComponent(url));
            audio.play();
        });

        socket.on('speak', function (words) {
            var chargeLi = $('<li class="play-anything"></li>');
            $(chargeLi).text("Spoke: "+words);
            $('#charges').prepend(chargeLi);
            var url = "http://translate.google.com/translate_tts?ie=UTF-8&q="+decodeURIComponent(words)+"&tl=en&total=1&idx=0&textlen=23&prev=input";
            var audio = new Audio(url);
            audio.play();
        });

    </script>
</head>

<body>
    <center>
        <br>
        <br>
        <br>
        <a href="/refresh" style="text-decoration: none;color:#CCCCCC">Refresh All Receivers</a><br>
        <form method="get" action="/any-url">
            <h1>
                Play: 
                <input type="text" name="url" placeholder="https://url-to/sound.mp3">
                <input type="submit" value="Play">
            </h1>
        </form>
        <form method="get" action="/speak">
            <h1>
            Speak: 
            <input type="text" name="words" placeholder="Hello World">
            <input type="submit" value="Say">
            </h1>
        </form>
        <div style="hide">
            <h1>Choo Choo: <audio id="choochoo" preload="auto" controls="yes">
              <source src="audio/choochoo.wav" type="audio/wave">
              <source src="audio/choochoo.mp3" type="audio/mpeg">
            </audio></h1>
            <h1>Crash: <audio id="crashed" preload="auto" controls="yes">
              <source src="audio/crash.wav" type="audio/wave">
              <source src="audio/crash.mp3" type="audio/mpeg">
            </audio></h1>
            <h1>Cha-ching: <audio id="cash_register" preload="auto" controls="yes">
              <source src="audio/cash_register.wav" type="audio/wave">
              <source src="audio/cash_register.mp3" type="audio/mpeg">
            </audio></h1>
            <h1>Fail: <audio id="denied" preload="auto" controls="yes">
              <source src="audio/denied.wav" type="audio/wave">
              <source src="audio/denied.mp3" type="audio/mpeg">
            </audio></h1>
        </div>
    </center>
    <br>
    <ul id="charges"></ul>
</body>

</html>
